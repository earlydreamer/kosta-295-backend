<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
    <link rel="stylesheet" type="text/css" href="./css/App.css">
    <link rel="stylesheet" type="text/css" href="./css/Header.css">
    <link rel="stylesheet" type="text/css" href="./css/List.css">
    <link rel="stylesheet" type="text/css" href="./css/TodoItem.css">
    <link rel="stylesheet" type="text/css" href="./css/Editor.css">

    
</head>
<body> 
 <div class="App">
    <div class="Header">
        <h3>ì˜¤ëŠ˜ì˜ PlanğŸ˜Š</h3>
        <h1>2025-10-20</h1>
    </div>
  <form>
    <div class="Editor">
            <input type="text" placeholder='ìƒˆë¡œìš´ todo'  id="input" />
            <button>ì¶”ê°€</button> 
    </div>
  </form>   

    <div class="List">
        <h4>Todo List ğŸŒ±</h4> <!--widow + .-->
        <input type="text" placeholder='ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' id="keyword" />

       
            <div class="todos_wrapper">
                <!--ì—¬ê¸°ì— í™”ë©´ ì¶œë ¥-->
            </div>
       
    </div>  
   
</div>

<script>
   
      let day =["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
      onload = ()=>{
          initData();
          
          const today = new Date();
          document.querySelector(".Header > h1").innerHTML=
          `${today.getFullYear()}ë…„ ${today.getMonth()+1}ì›” ${today.getDate()}ì¼  ${day[today.getDay()]}ìš”ì¼`;

      }

      new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
          key: "todoList",
          methodName: "selectAll"
      })
      async function initData (word){
    	
    	  body = new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
             key: "todoList",
             methodName : word ? "selectIncludesbyWord" : "selectAll",
             word : word
         });
    	 
    	 try{
    	  const response = await fetch("ajax", {
              method: "POST",
              body : body
          });

    	  if (!response.ok) {
              throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
          }
    	  
    	  const result = await response.json();
    	  
    	  
          let todosWrapper = document.querySelector(".todos_wrapper");
       
          let str="";
          result.forEach((todo, index)=>{
          
          str+='<div class="TodoItem">';
          str+=`<input type="checkbox"  onChange="onUpdate(this , ${todo.id} )" ${todo.done ? "checked" :"" }/>`;
          str+='<div class="content">'+todo.content+'</div>';
          str+=`<div class="date">${todo.date}</div>`;
          str+=`<button name="${todo.id}" onclick="todoDel(this)">ì‚­ì œ</button>`;
          str+='</div>';
          })

          todosWrapper.innerHTML=str;
          
    	 } catch (err) {
    	        alert("ì—ëŸ¬ ë°œìƒí–ˆì–´ìš”: " + err);
    	    }
         
      }

       // ì¶”ê°€ í´ë¦­
    
       document.querySelector(".Editor > button").onclick = async () =>{
        event.preventDefault();
        
          let inputEle = document.querySelector("#input");
         
          try{
        	  const response = await fetch("ajax", {
                  method: "POST",
                  body : new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
                      key: "todoList",
                      methodName: "insert",
                      content:inputEle.value
                  })
              });

        	  if (!response.ok) {
                  throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
              }
        	  
        	  const result = await response.json();
        	  console.log(result);
        	  
          }catch (err) {
  	        alert("ë“±ë¡ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
  	      }
          
          
          document.querySelector("#input").value="";
          initData();

         // return false;
      }
      /////////////////////////////////////////
       //ìˆ˜ì •
       const onUpdate = async (th , id)=>{ //TodoItemì—ì„œ í˜¸ì¶œí• ë•Œ ì „ë‹¬í•œ id
            console.log(th.checked);
            let done = th.checked ? "1" : "0";
           try{
        	  const response = await fetch("ajax", {
                  method: "POST",
                  body : new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
                      key: "todoList",
                      methodName: "update",
                      done,
                      id
                  })
              });

        	  if (!response.ok) {
                  throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
              }
        	  
        	  const result = await response.json();
        	  console.log(result);
        	  
          }catch (err) {
  	        alert("ìˆ˜ì •ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
  	      }
          
          
          initData();

       }
     
     ////////////////////////////////////////////////////
      // ì‚­ì œ
      const todoDel = async (th)=>{
   
          let targetId =th.getAttribute("name");
          
          try{
        	  const response = await fetch("ajax", {
                  method: "POST",
                  body : new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
                      key: "todoList",
                      methodName: "delete",
                      targetId
                  })
              });

        	  if (!response.ok) {
                  throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
              }
        	  
        	  const result = await response.json();
        	  console.log(result);
        	  
          }catch (err) {
  	        alert("ì‚­ì œì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
  	      }
        

          initData();
     }
     ////////////////////////////////////////////

     //ê²€ìƒ‰
     document.querySelector("#keyword").onkeyup = async (e)=>{
           let word = e.target.value;
         /*  try{
        	  const response = await fetch("ajax", {
                  method: "POST",
                  body : new URLSearchParams({ // í¼ë°ì´í„°ë¥¼ ì„œë²„ì— ì „ì†¡í• ë•Œ URLSearchParamsëŠ” key=todoList&methodName=selectAll í˜•íƒœë¡œ ë§Œë“¤ì–´ì¤Œ(ì„œë²„ê°€ ì „í†µì ì¸ ë°©ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°›ì„ ë•Œ ì‚¬ìš©)
                      key: "todoList",
                      methodName: "selectIncludesbyWord",
                      word
                  })
              });

        	  if (!response.ok) {
                  throw new Error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬: " + response.status);
              }
        	  
        	  const result = await response.json();
        	  console.log(result);
        	  
          }catch (err) {
  	        alert("ê²€ìƒ‰ì–´ ì— ë¬¸ì œê°€ ìƒê²»ì–´ìš”.: " + err);
  	      } */
          
          
          initData(word);
    } 

  </script>

</body>
</html>